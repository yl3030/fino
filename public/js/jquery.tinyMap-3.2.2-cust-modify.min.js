window.gMapsCallback=function(){$(window).trigger("gMapsCallback")},function(e,t,o,n){function r(e,t){var o={lat:"",lng:""},n=[],r=/^[+-]?\d+(\.\d+)?$/;if("string"==typeof e||Array.isArray(e)){if(n=Array.isArray(e)?e:e.toString().replace(/\s+/,"").split(","),2!==n.length)return e;r.test(n[0])&&r.test(n[1])&&(o.lat=n[0],o.lng=n[1])}else if("object"==typeof e){if("function"==typeof e.lat)return e;e.hasOwnProperty("x")&&e.hasOwnProperty("y")?(o.lat=e.x,o.lng=e.y):e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&(o.lat=e.lat,o.lng=e.lng)}return!0===t?new google.maps.LatLng(o.lat,o.lng):o}function s(o,n){var r=this,i=e.extend({},c,n);r.map=null,r._markers=[],r._markersCluster=[],r._clusters=[],r._labels=[],r._polylines=[],r._polygons=[],r._circles=[],r._kmls=[],r._directions=[],r._directionsMarkers=[],r._places=[],r.container=o,r.options=i,r.googleMapOptions={},r.interval=parseInt(r.options.interval,10)||200,e(t).on("gMapsCallback",function(){r.init()}),e(this.container).html(i.loading),r.init()}var a=!1,p=!1,l={sensor:!1,language:"zh-TW",callback:"gMapsCallback",api:"//maps.google.com/maps/api/js",clusterer:"//google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js"},c={autoLocation:!1,center:[24,121],infoWindowAutoClose:!0,interval:200,loading:"讀取中&hellip;",notFound:"找不到查詢的地點",zoom:8},d={},g={};d={greyscale:[{featureType:"all",stylers:[{saturation:-100},{gamma:.5}]}]},s.prototype={VERSION:"3.2.2",bounds:{},overlay:function(){var e=this.map,t=this.options;try{this.kml(e,t),this.direction(e,t),this.markers(e,t),this.drawPolyline(e,t),this.drawPolygon(e,t),this.drawCircle(e,t),this.streetView(e,t),this.places(e,t),this.geoLocation(e,t)}catch(o){console.info(o)}},bindEvents:function(e,t){var o=this,n={};switch(typeof t){case"function":google.maps.event.addListener(e,"click",t);break;case"object":for(n in t)"function"==typeof t[n]?google.maps.event.addListener(e,n,t[n]):t[n].hasOwnProperty("func")&&"function"==typeof t[n].func?t[n].hasOwnProperty("once")&&!0===t[n].once?google.maps.event.addListenerOnce(e,n,t[n].func):google.maps.event.addListener(e,n,t[n].func):"function"==typeof t[n]&&google.maps.event.addListener(e,n,t[n])}e.hasOwnProperty("infoWindow")&&google.maps.event.addListener(e,"click",function(){var t=0,n={};if(o.options.hasOwnProperty("infoWindowAutoClose")&&!0===o.options.infoWindowAutoClose)for(t=o._markers.length-1;t>=0;t-=1)n=o._markers[t],n.hasOwnProperty("infoWindow")&&"function"==typeof n.infoWindow.close&&n.infoWindow.close();e.infoWindow.open(o.map,e)})},kml:function(t,o){var n=this,r={url:"",map:t,preserveViewport:!1,suppressInfoWindows:!1},i={},s=0;if(o.hasOwnProperty("kml"))if("string"==typeof o.kml)r.url=o.kml,i=new google.maps.KmlLayer(r),this._kmls.push(i);else if(Array.isArray(o.kml))for(s=o.kml.length-1;s>=0;s-=1)"string"==typeof o.kml[s]?(r.url=o.kml[s],i=new google.maps.KmlLayer(r)):"object"==typeof o.kml[s]&&(r=e.extend({},r,o.kml[s]),i=new google.maps.KmlLayer(r),r.hasOwnProperty("event")&&n.bindEvents(i,r.event)),this._kmls.push(i)},drawPolyline:function(t,o){var n=this,i={},s=[],a={},p={},l={},c={},d=[],g=[],y=0,f={},h={},m=0;if(routeCallback=function(e,t){if(t===google.maps.DirectionsStatus.OK){for(m=e.routes[0].overview_path.length-1;m>=0;m-=1)g.push(e.routes[0].overview_path[m]);a.setPath(g),"function"==typeof i.getDistance&&(p=e.routes[0].legs[0].distance,i.getDistance.call(this,p))}},o.hasOwnProperty("polyline")&&Array.isArray(o.polyline))for(y=o.polyline.length-1;y>=0;y-=1)if(i=o.polyline[y],i.hasOwnProperty("coords")&&Array.isArray(i.coords)){for(d=new google.maps.MVCArray,m=i.coords.length-1;m>=0;m-=1)h=i.coords[m],f=r(h,!0),"function"==typeof f.lat&&d.push(f);if(c=e.extend({},{strokeColor:i.color||"#FF0000",strokeOpacity:i.opacity||1,strokeWeight:i.width||2},i),a=new google.maps.Polyline(c),n._polylines.push(a),2<d.getLength())for(m=d.length-1;m>=0;m-=1)m>0&&d.length-1>m&&s.push({location:d.getAt(m),stopover:!1});a&&c.hasOwnProperty("event")&&c.event.hasOwnProperty("created")&&"function"==typeof c.event.created&&c.event.created.call(a,n),i.hasOwnProperty("event")&&n.bindEvents(a,i.event),i.hasOwnProperty("snap")&&!0===i.snap?(l=new google.maps.DirectionsService,l.route({origin:d.getAt(0),waypoints:s,destination:d.getAt(d.length-1),travelMode:google.maps.DirectionsTravelMode.DRIVING},routeCallback)):(a.setPath(d),google.maps.hasOwnProperty("geometry")&&google.maps.geometry.hasOwnProperty("spherical")&&"function"==typeof google.maps.geometry.spherical.computeDistanceBetween&&(p=google.maps.geometry.spherical.computeDistanceBetween(d.getAt(0),d.getAt(d.length-1)),"function"==typeof i.getDistance&&i.getDistance.call(n,p))),a.setMap(t)}},drawPolygon:function(t,o){var n=this,i={},s={},a=[],p=0,l=0,c={},d={};if(o.hasOwnProperty("polygon")&&Array.isArray(o.polygon))for(p=o.polygon.length-1;p>=0;p-=1)if(a=[],o.polygon[p].hasOwnProperty("coords")){for(l=o.polygon[p].coords.length-1;l>=0;l-=1)c=o.polygon[p].coords[l],d=r(c,!0),"function"==typeof d.lat&&a.push(d);s=e.extend({},{path:a,strokeColor:o.polygon[p].color||"#FF0000",strokeOpacity:1,strokeWeight:o.polygon[p].width||2,fillColor:o.polygon[p].fillcolor||"#CC0000",fillOpacity:.35},o.polygon[p]),i=new google.maps.Polygon(s),i&&s.hasOwnProperty("event")&&s.event.hasOwnProperty("created")&&"function"==typeof s.event.created&&s.event.created.call(i,n),s.hasOwnProperty("event")&&n.bindEvents(i,s.event),n._polygons.push(i),i.setMap(t)}},drawCircle:function(t,o){var n=this,i={},s={},a={},p={},l=0;if(o.hasOwnProperty("circle")&&Array.isArray(o.circle))for(l=o.circle.length-1;l>=0;l-=1)s=o.circle[l],a=e.extend({},{map:t,strokeColor:s.color||"#FF0000",strokeOpacity:s.opacity||.8,strokeWeight:s.width||2,fillColor:s.fillcolor||"#FF0000",fillOpacity:s.fillopacity||.35,radius:s.radius||10,zIndex:100,id:s.hasOwnProperty("id")?s.id:""},s),s.hasOwnProperty("center")&&(p=r(s.center,!0),a.center=p),"function"==typeof p.lat&&(i=new google.maps.Circle(a),n._circles.push(i),i&&a.hasOwnProperty("event")&&a.event.hasOwnProperty("created")&&"function"==typeof a.event.created&&a.event.created.call(i,n),s.hasOwnProperty("event")&&n.bindEvents(i,s.event))},markers:function(t,o,i){if(!o.hasOwnProperty("marker")||!Array.isArray(o.marker))return!1;var s=this,a={},p=0,l=0,c={},d=s._markers,g=s._labels,y=new google.maps.Geocoder,f=function(e,t){if(t!==google.maps.GeocoderStatus.OK)throw"Geocoder Status: "+t;d[l].setPosition(e[0].geometry.location)};if(!i||0===d.length){for(p=0;p<o.marker.length;p+=1)a=o.marker[p],a.hasOwnProperty("addr")&&(a.parseAddr=r(a.addr,!0),"string"==typeof a.parseAddr?s.markerByGeocoder(t,a,o):s.markerDirect(t,a,o));i=n}if("modify"===i)for(p=0;p<o.marker.length;p+=1){if(o.marker[p].hasOwnProperty("id")){for(l=0;l<d.length;l+=1)if(o.marker[p].id===d[l].id&&o.marker[p].hasOwnProperty("addr"))c=r(o.marker[p].addr,!0),"string"==typeof c?y.geocode({address:c},f):d[l].setPosition(c),o.marker[p].hasOwnProperty("text")&&(d[l].hasOwnProperty("infoWindow")?"function"==typeof d[l].infoWindow.setContent&&d[l].infoWindow.setContent(o.marker[p].text):(d[l].infoWindow=new google.maps.InfoWindow({content:o.marker[p].text}),s.bindEvents(d[l],o.marker[p].event))),o.marker[p].hasOwnProperty("icon")&&d[l].setIcon(o.marker[p].icon);else if(o.marker[p].hasOwnProperty("forceInsert")&&o.marker[p].forceInsert===!0&&o.marker[p].hasOwnProperty("addr")){o.marker[p].parseAddr=r(o.marker[p].addr,!0),"string"==typeof o.marker[p].parseAddr?s.markerByGeocoder(t,o.marker[p],o):s.markerDirect(t,o.marker[p]);break}}else o.marker[p].hasOwnProperty("addr")&&(o.marker[p].parseAddr=r(o.marker[p].addr,!0),"string"==typeof o.marker[p].parseAddr?s.markerByGeocoder(t,o.marker[p]):s.markerDirect(t,o.marker[p]));for(l=0;l<g.length;l+=1)o.marker[p].id===g[l].id&&(o.marker[p].hasOwnProperty("label")&&(g[l].text=o.marker[p].label),o.marker[p].hasOwnProperty("css")&&e(g[l].span).addClass(o.marker[p].css),g[l].draw())}},markerIcon:function(t){var o=e.extend({},t.icon);if(t.hasOwnProperty("icon")){if("string"==typeof t.icon)return t.icon;t.icon.hasOwnProperty("url")&&(o.url=t.icon.url),t.icon.hasOwnProperty("size")&&Array.isArray(t.icon.size)&&2===t.icon.size.length&&(o.size=new google.maps.Size(t.icon.size[0],t.icon.size[1])),t.icon.hasOwnProperty("scaledSize")&&Array.isArray(t.icon.scaledSize)&&2===t.icon.scaledSize.length&&(o.scaledSize=new google.maps.Size(t.icon.scaledSize[0],t.icon.scaledSize[1])),t.icon.hasOwnProperty("anchor")&&Array.isArray(t.icon.anchor)&&2===t.icon.anchor.length&&(o.anchor=new google.maps.Point(t.icon.anchor[0],t.icon.anchor[1]))}return o},markerDirect:function(t,o){var n=this,r={},i={},s=o.hasOwnProperty("id")?o.id:"",a=o.hasOwnProperty("title")?o.title.toString().replace(/<([^>]+)>/g,""):!1,p=o.hasOwnProperty("text")?o.text.toString():!1,l=n.markerIcon(o),c={maxZoom:null,gridSize:60},d=e.extend({},{map:t,position:o.parseAddr,animation:null,id:s},o);a&&(d.title=a),p&&(d.text=p,d.infoWindow=new google.maps.InfoWindow({content:p})),e.isEmptyObject(l)||(d.icon=l),o.hasOwnProperty("animation")&&"string"==typeof o.animation&&(d.animation=google.maps.Animation[o.animation.toUpperCase()]),r=new google.maps.Marker(d),n._markers.push(r),r&&o.hasOwnProperty("event")&&o.event.hasOwnProperty("created")&&"function"==typeof o.event.created&&o.event.created.call(r,n),r.hasOwnProperty("position")&&("function"==typeof r.getPosition&&n.bounds.extend(r.position),n.options.hasOwnProperty("markerFitBounds")&&!0===n.options.markerFitBounds&&n._markers.length===n.options.marker.length&&t.fitBounds(n.bounds)),(!o.hasOwnProperty("cluster")||o.hasOwnProperty("cluster")&&!0===o.cluster)&&n._markersCluster.push(r),n.options.hasOwnProperty("markerCluster")&&"function"==typeof MarkerClusterer&&(c=e.extend({},c,n.options.markerCluster),n._markers.length===n.options.marker.length&&n._clusters.push(new MarkerClusterer(t,n._markersCluster,c))),o.hasOwnProperty("label")&&(i=new g({text:o.label,map:t,css:o.hasOwnProperty("css")?o.css.toString():"",id:s}),i.bindTo("position",r,"position"),i.bindTo("text",r,"position"),i.bindTo("visible",r),n._labels.push(i)),n.bindEvents(r,o.event)},markerByGeocoder:function(o,n,r){var i=new google.maps.Geocoder,s=this;i.geocode({address:n.parseAddr},function(i,a){if(a===google.maps.GeocoderStatus.OVER_QUERY_LIMIT)t.setTimeout(function(){s.markerByGeocoder(o,n)},s.interval);else if(a===google.maps.GeocoderStatus.OK){var p={},l={},c=n.hasOwnProperty("id")?n.id:"",d=n.hasOwnProperty("title")?n.title.toString().replace(/<([^>]+)>/g,""):!1,y=n.hasOwnProperty("text")?n.text.toString():!1,f={maxZoom:null,gridSize:60},h={map:o,position:i[0].geometry.location,animation:null,visible:!0,id:c},m=s.markerIcon(n);d&&(h.title=d),y&&(h.text=y,h.infoWindow=new google.maps.InfoWindow({content:y})),e.isEmptyObject(m)||(h.icon=m),n.hasOwnProperty("animation")&&"string"==typeof n.animation&&(h.animation=google.maps.Animation[n.animation.toUpperCase()]),h=e.extend({},h,n),p=new google.maps.Marker(h),p&&n.hasOwnProperty("event")&&n.event.hasOwnProperty("created")&&"function"==typeof n.event.created&&n.event.created.call(p,s),s._markers.push(p),p.hasOwnProperty("position")&&("function"==typeof p.getPosition&&s.bounds.extend(p.position),s.options.hasOwnProperty("markerFitBounds")&&!0===s.options.markerFitBounds&&s._markers.length===r.marker.length&&o.fitBounds(s.bounds)),(!n.hasOwnProperty("cluster")||n.hasOwnProperty("cluster")&&!0===n.cluster)&&s._markersCluster.push(p),s.options.hasOwnProperty("markerCluster")&&"function"==typeof MarkerClusterer&&s._markers.length===r.marker.length&&(f=e.extend({},f,s.options.markerCluster),s._clusters.push(new MarkerClusterer(o,s._markersCluster,f))),n.hasOwnProperty("label")&&(l=new g({text:n.label,map:s.map,css:n.hasOwnProperty("css")?n.css.toString():"",id:c}),l.bindTo("position",p,"position"),l.bindTo("text",p,"position"),l.bindTo("visible",p),s._labels.push(l)),s.bindEvents(p,n.event)}})},direction:function(e,t){var o=0;if(t.hasOwnProperty("direction")&&Array.isArray(t.direction))for(o=0;o<t.direction.length;o-=1)this.directionService(t.direction[o])},directionService:function(t){if(t.hasOwnProperty("from")&&t.hasOwnProperty("to")){var o=this,n=new google.maps.DirectionsService,s=new google.maps.DirectionsRenderer,a={},p=[],l=[],c=new google.maps.InfoWindow,d=[],g={},y="",f="",h={travelMode:google.maps.DirectionsTravelMode.DRIVING,optimizeWaypoints:t.hasOwnProperty("optimize")?t.optimize:!0};if(i=0,h.origin=r(t.from,!0),h.destination=r(t.to,!0),g=e.extend({},{infoWindow:c,map:o.map},t),t.hasOwnProperty("travel")&&google.maps.TravelMode[t.travel.toString().toUpperCase()]&&(h.travelMode=google.maps.TravelMode[t.travel.toString().toUpperCase()]),t.hasOwnProperty("panel")&&e(t.panel).length&&(g.panel=e(t.panel).get(0)),t.hasOwnProperty("waypoint")&&Array.isArray(t.waypoint)){for(i=0;i<t.waypoint.length;i+=1)a={},"string"==typeof t.waypoint[i]||Array.isArray(t.waypoint[i])?a={location:r(t.waypoint[i],!0),stopover:!0}:(t.waypoint[i].hasOwnProperty("location")&&(a.location=r(t.waypoint[i].location,!0)),a.stopover=t.waypoint[i].hasOwnProperty("stopover")?t.waypoint[i].stopover:!0),p.push(t.waypoint[i].text||t.waypoint[i].toString()),t.waypoint[i].hasOwnProperty("icon")&&l.push(t.waypoint[i].icon.toString()),d.push(a);console.dir(d),h.waypoints=d}n.route(h,function(e,n){var r=[],i={},a=0;if(n===google.maps.DirectionsStatus.OK){r=e.routes[0].legs;try{for(t.hasOwnProperty("fromText")&&(r[0].start_address=t.fromText,y=t.fromText),t.hasOwnProperty("toText")&&(1===r.length?r[0].end_address=t.toText:r[r.length-1].end_address=t.toText,f=t.toText),t.hasOwnProperty("icon")&&(g.suppressMarkers=!0,t.icon.hasOwnProperty("from")&&"string"==typeof t.icon.from&&o.directionServiceMarker(r[0].start_location,{icon:t.icon.from,text:y},c,t),t.icon.hasOwnProperty("to")&&"string"==typeof t.icon.to&&o.directionServiceMarker(r[r.length-1].end_location,{icon:t.icon.to,text:f},c,t)),a=r.length-1;a>=0;a-=1)t.hasOwnProperty("icon")&&(t.icon.hasOwnProperty("waypoint")&&"string"==typeof t.icon.waypoint?i.icon=t.icon.waypoint:"string"==typeof l[a-1]&&(i.icon=l[a-1]),i.text=p[a-1],o.directionServiceMarker(r[a].start_location,i,c,t))}catch(d){}o.bindEvents(s,t.event),s.setOptions(g),s.setDirections(e)}}),o._directions.push(s)}},directionServiceMarker:function(t,o,n,r){var i=this,s={},a=e.extend({},{position:t,map:i.map,id:r.hasOwnProperty("id")?r.id:""},o),p=new google.maps.Marker(a);a.hasOwnProperty("text")&&(s=function(){n.setPosition(t),n.setContent(a.text),n.open(i.map,p)}),i._directionsMarkers.push(p),i.bindEvents(p,s)},getDirectionsInfo:function(){var e=this,t=[],o=null,n=e._directions,r=0,i=0,s=0,a=0;if(n)for(s=0,r=n.length;r>s;s+=1)if(n[s].hasOwnProperty("directions")&&n[s].directions.hasOwnProperty("routes")&&"undefined"!=typeof n[s].directions.routes[0].legs)for(o=n[s].directions.routes[0].legs,t[s]=[],a=0,i=o.length;i>a;a+=1)t[s].push({from:o[a].start_address,to:o[a].end_address,distance:o[a].distance,duration:o[a].duration});return t},streetView:function(t,o){var n=this,i={},s=o.hasOwnProperty("streetViewObj")?o.streetViewObj:{},a={};"function"==typeof t.getStreetView&&o.hasOwnProperty("streetViewObj")&&(i=t.getStreetView(),s.hasOwnProperty("position")?(a=r(s.position,!0),s.position="object"==typeof a?t.getCenter():a):s.position=t.getCenter(),s.hasOwnProperty("pov")&&(s.pov=e.extend({},{heading:0,pitch:0,zoom:1},s.pov)),s.hasOwnProperty("visible")&&i.setVisible(s.visible),i.setOptions(s),s.hasOwnProperty("event")&&n.bindEvents(i,s.event))},places:function(t,o){var n=this,r={},i=o.hasOwnProperty("places")?o.places:{},s=e.extend({},{location:t.getCenter(),radius:100},i),a=0;"undefined"!=typeof google.maps.places&&s.hasOwnProperty("query")&&(r=new google.maps.places.PlacesService(t),r.textSearch(s,function(e,o){if(o===google.maps.places.PlacesServiceStatus.OK&&(n.places=e,s.hasOwnProperty("createMarker")&&!0===s.createMarker))for(a=e.length-1;a>=0;a-=1)e[a].hasOwnProperty("geometry")&&n._markers.push(new google.maps.Marker({map:t,position:e[a].geometry.location}))}))},geoLocation:function(t,o){try{var n=this,r=navigator.geolocation,i={};if(!r)return;o.hasOwnProperty("geolocation")&&(i=e.extend({},{maximumAge:6e5,timeout:3e3,enableHighAccuracy:!1},o.geolocation)),(!0===o.autoLocation||"function"==typeof o.autoLocation)&&r.getCurrentPosition(function(e){"undefined"!=typeof e&&"coords"in e&&"latitude"in e.coords&&"longitude"in e.coords&&(t.panTo(new google.maps.LatLng(e.coords.latitude,e.coords.longitude)),"function"==typeof o.autoLocation&&o.autoLocation.call(n,e))},function(e){console.error(e)},i)}catch(s){}},panTo:function(e){var t=this.map,o={},n={};return null!==t&&"undefined"!=typeof t&&(o=r(e,!0),"string"==typeof o?(n=new google.maps.Geocoder,n.geocode({address:o},function(e,o){o===google.maps.GeocoderStatus.OK&&"function"==typeof t.panTo&&Array.isArray(e)&&e.length?e[0].hasOwnProperty("geometry")&&t.panTo(e[0].geometry.location):console.error(o)})):"function"==typeof t.panTo&&t.panTo(o)),this},clear:function(t){var o=this,n=o._directionsMarkers,r=o._labels,i=[],s={},a={},p="",l=0,c=0;"undefined"==typeof t&&(t={marker:[],label:[],polygon:[],polyline:[],circle:[],direction:[],kml:[]});try{for(a in t)if(Array.isArray(t[a])&&(p="_"+a.toString().toLowerCase()+"s","undefined"!=typeof o[p])){for(i=[],l=0;l<o[p].length;l+=1)if(s=o[p][l],0===t[a].length||-1!==t[a].indexOf(l)||s.hasOwnProperty("id")&&0<s.id.length&&-1!==t[a].indexOf(s.id)){if("_markers"===p&&"undefined"!=typeof r[l]&&r.hasOwnProperty("div")&&o._labels[l].div.remove(),"_directions"===p)for(c=n.length-1;c>=0;c-=1)"function"==typeof n[c].setMap&&(o._directionsMarkers[c].setMap(null),o._directionsMarkers.splice(c,1));"function"==typeof s.set&&(s.set("visible",!1),s.set("directions",null)),"function"==typeof s.setMap&&s.setMap(null),i.push(l)}for(l=0;l<i.length;l+=1)o[p].splice(l,1)}}catch(d){console.warn(d)}finally{return e(o.container)}},get:function(e,t){var o=this,n=(o._directionsMarkers,o._labels,[]),r={},i={},s="",a=0;"undefined"==typeof e&&(e={marker:[],label:[],polygon:[],polyline:[],circle:[],direction:[],kml:[]});try{for(i in e)if(Array.isArray(e[i])&&(s="_"+i.toString().toLowerCase()+"s","undefined"!=typeof o[s])){for(n[i]=[],a=0;a<o[s].length;a+=1)r=o[s][a],(0===e[i].length||-1!==e[i].indexOf(a)||r.hasOwnProperty("id")&&0<r.id.length&&-1!==e[i].indexOf(r.id))&&n[i].push(r);for(a=0;a<n.length;a+=1)o[s].splice(a,1)}"function"==typeof t&&t.call(this,n)}catch(p){console.warn(p)}finally{return n}},modify:function(t){var o=this,n=[],r=[["kml","kml"],["marker","markers"],["direction","direction"],["polyline","drawPolyline"],["polygon","drawPolygon"],["circle","drawCircle"],["streetView","streetView"],["markerFitBounds","markerFitBounds"]],i=0,s=o.map;if("undefined"!=typeof t){for(i=r.length-1;i>=0;i-=1)t.hasOwnProperty(r[i][0])&&n.push(r[i][1]);if(null!==s){if(n.length)for(i=n.length-1;i>=0;i-=1)console.dir(n[i]),"function"==typeof o[n[i]]&&("streetView"===n[i]&&(t.streetViewObj=t.streetView,delete t.streetView),o[n[i]](s,t,"modify"));else s.setOptions(t);t.hasOwnProperty("event")&&o.bindEvents(s,t.event),google.maps.event.trigger(s,"resize")}}return e(this.container)},destroy:function(){var t=e(this.container);return t.length&&e.removeData(this.container,"tinyMap"),t.empty()},getKML:function(o){var n=e(this.container),r=n.data("tinyMap"),i=e.extend({},{marker:!0,polyline:!0,direction:!0,download:!1},o),s="data:application/vnd.google-earth.kml+xml;charset=utf-8;base64,",a={xml:['<?xml version="1.0" encoding="UTF-8"?>','<kml xmlns="http://earth.google.com/kml/2.2">',"<Document>","<name><![CDATA[]]></name>","<description><![CDATA[]]></description>",'<Style id="style1">',"<IconStyle>","<Icon>","<href>//maps.google.com/mapfiles/kml/paddle/grn-circle_maps.png</href>","</Icon>","</IconStyle>","</Style>","#PLACEMARKS#","</Document>","</kml>"],placemark:["<Placemark>","<name><![CDATA[]]></name>","<Snippet></Snippet>","<description><![CDATA[]]></description>","<styleUrl>#style1</styleUrl>","<ExtendedData>","</ExtendedData>","#DATA#","</Placemark>"],linestring:"<LineString><tessellate>1</tessellate><coordinates>#LATLNG#</coordinates></LineString>",point:"<Point><coordinates>#LATLNG#,0.000000</coordinates></Point>"},p=[],l=[],c=[],d="",g="",y="",f="",h="",m=[],u=[],w={},v=0,O=-1,k=-1,P=-1;if(r){if(!0===i.marker)for(p=r._markers,v=length-1;v>=0;v-=1)h=p[v].position.lng()+","+p[v].position.lat(),d+=a.placemark.join("").replace(/#DATA#/gi,a.point.replace(/#LATLNG#/gi,h));if(!0===i.polyline)for(l=r._polylines,v=l.length-1;v>=0;v-=1){for(w=l[v].getPath().getArray(),h="",O=w.length-1;O>=0;O-=1)h+=w[O].lng()+","+w[O].lat()+",0.000000\n";g+=a.placemark.join("").replace(/#DATA#/gi,a.linestring.replace(/#LATLNG#/gi,h))}if(!0===i.direction)for(c=r._directions,v=c.length-1;v>=0;v-=1)if(c[v].hasOwnProperty("directions")&&c[v].directions.hasOwnProperty("routes")&&Array.isArray(c[v].directions.routes)&&0<c[v].directions.routes.length&&c[v].directions.routes[0].hasOwnProperty("legs")&&Array.isArray(c[v].directions.routes[0].legs))for(m=c[v].directions.routes[0].legs,O=m.length-1;O>=0;O-=1)if(Array.isArray(m[O].steps))for(k=m[O].steps.length-1;k>=0;k-=1){if(h="",Array.isArray(m[O].steps[k].path))for(P=m[O].steps[k].path.length-1;P>=0;P-=1)u=m[O].steps[k].path[P],"undefined"!=typeof u&&"function"==typeof u.lat&&(h+=u.lng()+","+u.lat()+",0.000000\n");y+=a.placemark.join("").replace(/#DATA#/gi,a.linestring.replace(/#LATLNG#/gi,h))}if(f=a.xml.join("").replace(/#PLACEMARKS#/gi,d+g+y),!0!==i.download)return f;t.open(s+t.btoa(t.decodeURIComponent(t.encodeURIComponent(f))))}},init:function(){var n=this,i={},s={},c=e.extend({},l),y=c.api.split("?")[0],f="",h={};try{delete c.api,delete c.clusterer,c=e.param(c)}catch(m){}if(a||"undefined"!=typeof t.google||(i=o.createElement("script"),i.setAttribute("src",[y,c].join("?")),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(i),a=!0,i=null),p||"undefined"!=typeof MarkerClusterer||(i=o.createElement("script"),i.setAttribute("src",l.clusterer),(o.getElementsByTagName("head")[0]||o.documentElement).appendChild(i),p=!0,i=null),"object"==typeof t.google){n.bounds=new google.maps.LatLngBounds,g=function(t){var o=this,n=t.hasOwnProperty("css")?t.css.toString():"";o.setValues(t),o.span=e("<span/>").css({position:"relative",left:"-50%",top:"0","white-space":"nowrap"}).addClass(n),o.div=e("<div/>").css({position:"absolute",display:"none"}),o.span.appendTo(o.div)},g.prototype=new google.maps.OverlayView,g.prototype.onAdd=function(){var t=this;t.div.appendTo(e(t.getPanes().overlayLayer)),t.listeners=[google.maps.event.addListener(t,"visible_changed",t.onRemove)]},g.prototype.draw=function(){var e=this.getProjection(),t={};try{t=e.fromLatLngToDivPixel(this.get("position")),this.div.css({left:t.x+"px",top:t.y+"px",display:"block"}),this.text&&this.span.html(this.text.toString())}catch(o){console.error(o)}},g.prototype.onRemove=function(){e(this.div).remove()};for(h in n.options)n.options.hasOwnProperty(h)&&(vo=n.options[h],/ControlOptions/g.test(h)&&vo.hasOwnProperty("position")&&"string"==typeof vo.position&&(n.options[h].position=google.maps.ControlPosition[vo.position.toUpperCase()]));n.googleMapOptions=n.options,n.options.hasOwnProperty("streetView")&&(n.googleMapOptions.streetViewObj=n.options.streetView,delete n.googleMapOptions.streetView),n.googleMapOptions.center=r(n.options.center,!0),n.options.hasOwnProperty("styles")&&("string"==typeof n.options.styles&&d.hasOwnProperty(n.options.styles)?n.googleMapOptions.styles=d[n.options.styles]:Array.isArray(n.options.styles)&&(n.googleMapOptions.styles=n.options.styles)),"string"==typeof n.options.center?(s=new google.maps.Geocoder,s.geocode({address:n.options.center},function(o,r){try{r===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?t.setTimeout(function(){n.init()},n.interval):r===google.maps.GeocoderStatus.OK&&Array.isArray(o)?0<o.length&&o[0].hasOwnProperty("geometry")&&(n.googleMapOptions.center=o[0].geometry.location,n.map=new google.maps.Map(n.container,n.googleMapOptions),google.maps.event.addListenerOnce(n.map,"idle",function(){n.overlay(),google.maps.event.trigger(n.map,"resize")}),n.bindEvents(n.map,n.options.event)):(f=(n.options.notFound||r).toString(),n.container.innerHTML(e("<div/>").text(f).html()),console.error("Geocoder Error Code: "+r))}catch(i){console.error(i)}})):(n.map=new google.maps.Map(n.container,n.googleMapOptions),google.maps.event.addListenerOnce(n.map,"idle",function(){n.overlay(),google.maps.event.trigger(n.map,"resize")}),n.bindEvents(n.map,n.options.event))}}},e.fn.tinyMapConfigure=function(t){l=e.extend(l,t)},e.fn.tinyMapDistance=function(t,o){var n={key:l.hasOwnProperty("key")?l.key:"",origins:[],destinations:[],language:"zh-TW"},r=e.extend({},n,t);Array.isArray(r.origins)&&(r.origins=r.origins.join("|")),Array.isArray(r.destinations)&&(r.destinations=r.destinations.join("|")),e.getJSON("//maps.googleapis.com/maps/api/distancematrix/json",r,function(e){"OK"===e.status&&o(e)})},e.fn.tinyMapQuery=function(t,o){var n={key:l.hasOwnProperty("key")?l.key:"",language:"zh-TW"},r=e.extend({},n,t),i=null;e.getJSON("//maps.googleapis.com/maps/api/geocode/json",r,function(e){"OK"===e.status?e.results&&"undefined"!=typeof e.results[0]&&(r.hasOwnProperty("latlng")?i=e.results[0].formatted_address:r.hasOwnProperty("address")&&(i=[e.results[0].geometry.location.lat,e.results[0].geometry.location.lng].join(",")),o(i,e)):o(!1,e)})},e.fn.tinyMap=function(t){var o={},n=[],r=arguments,i="tinyMap";return"string"==typeof t?(this.each(function(){o=e.data(this,i),o instanceof s&&"function"==typeof o[t]&&(n=o[t].apply(o,Array.prototype.slice.call(r,1)))}),"undefined"!=typeof n?n:this):this.each(function(){e.data(this,i)||e.data(this,i,new s(this,t))})}}(window.jQuery||{},window,document);